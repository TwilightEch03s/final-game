import*as o from"https://esm.sh/three@0.181.2";import{OrbitControls as xt}from"https://esm.sh/three@0.181.2/examples/jsm/controls/OrbitControls.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const d of s)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(s){const d={};return s.integrity&&(d.integrity=s.integrity),s.referrerPolicy&&(d.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?d.credentials="include":s.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function n(s){if(s.ep)return;s.ep=!0;const d=r(s);fetch(s.href,d)}})();function N(t,e,r,n,s=0,d=1.1,c=0,l=6710886){const a=new o.Mesh(new o.BoxGeometry(t.width,t.height,t.depth),new o.MeshStandardMaterial({color:l}));a.position.set(e.x,s,e.z),a.rotation.x=D(c),r.add(a);const u=new o.Mesh(new o.BoxGeometry(t.width,t.height,t.depth),new o.MeshStandardMaterial({color:0,wireframe:!0}));u.position.set(e.x,s,e.z),u.rotation.x=D(c),r.add(u);const f=new Ammo.btQuaternion;f.setRotation(new Ammo.btVector3(1,0,0),D(c));const h=new Ammo.btTransform;h.setIdentity(),h.setRotation(f),h.setOrigin(new Ammo.btVector3(e.x,s,e.z));const b=new Ammo.btBoxShape(new Ammo.btVector3(t.width/2,t.height/2,t.depth/2)),y=new Ammo.btDefaultMotionState(h),w=new Ammo.btVector3(0,0,0);b.calculateLocalInertia(0,w);const p=new Ammo.btRigidBodyConstructionInfo(0,y,b,w),x=new Ammo.btRigidBody(p);return x.setRestitution(d),n.addRigidBody(x),x}function Mt(t,e,r,n,s,d,c=0,l=0){const a=new o.Shape;a.moveTo(-t.width+e.x,-16+e.z),a.lineTo(t.width+e.x,-16+e.z),a.lineTo(t.width+e.x,t.height+e.z),a.lineTo(-t.width+e.x,t.height+e.z),a.lineTo(-t.width+e.x,-16+e.z);const u=new o.Path;u.moveTo(-1.5+n.x,-r.height+n.z),u.lineTo(r.width+n.x,-r.height+n.z),u.lineTo(r.width+n.x,r.height+n.z),u.lineTo(-1.5+n.x,r.height+n.z),u.lineTo(-1.5+n.x,-r.height+n.z),a.holes.push(u);const f=new o.ShapeGeometry(a),h=new o.MeshStandardMaterial({color:10066329,side:o.DoubleSide}),b=new o.Mesh(f,h);b.rotation.x=-Math.PI/2+D(l),b.position.y=c,s.add(b);const y=new Ammo.btCompoundShape,w=new Ammo.btTransform;w.setIdentity();const p=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(n.z-e.z+(t.height-r.height))/2,.1));w.setOrigin(new Ammo.btVector3(e.x,(e.z+n.z-t.height-r.height)/2,c)),y.addChildShape(w,p);const x=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(t.height-r.height-(n.z-e.z))/2,.1));w.setOrigin(new Ammo.btVector3(e.x,(t.height+r.height+e.z+n.z)/2,c)),y.addChildShape(w,x);const L=new Ammo.btBoxShape(new Ammo.btVector3((n.x-e.x+(t.width-r.width))/2,r.height,.1));w.setOrigin(new Ammo.btVector3((e.x+n.x-t.width-r.width)/2,n.z,c)),y.addChildShape(w,L);const M=new Ammo.btBoxShape(new Ammo.btVector3((t.width-r.width-(n.x-e.x))/2,r.height,.1));w.setOrigin(new Ammo.btVector3((e.x+n.x+r.width+t.width)/2,n.z,c)),y.addChildShape(w,M);const A=new Ammo.btTransform;A.setIdentity();const rt=new Ammo.btQuaternion;rt.setRotation(new Ammo.btVector3(1,0,0),-Math.PI/2+D(l)),A.setRotation(rt),A.setOrigin(new Ammo.btVector3(0,0,0));const pt=new Ammo.btDefaultMotionState(A),gt=new Ammo.btVector3(0,0,0),bt=new Ammo.btRigidBodyConstructionInfo(0,pt,y,gt),st=new Ammo.btRigidBody(bt);return d.addRigidBody(st),st}function ct(t,e,r,n,s,d){const c=t instanceof Ammo.btSphereShape?new o.Mesh(new o.SphereGeometry(1,32,32),new o.MeshStandardMaterial({color:10066329})):new o.Mesh(new o.BoxGeometry(1.5,1.5,1.5),new o.MeshStandardMaterial({color:6710886}));c.position.set(r.x,r.y,r.z),n.add(c);const l=new Ammo.btTransform;l.setIdentity(),l.setOrigin(new Ammo.btVector3(r.x,r.y,r.z));const a=new Ammo.btDefaultMotionState(l),u=new Ammo.btVector3(0,0,0);e&&t.calculateLocalInertia(e,u);const f=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(e,a,t,u));return f.setRestitution(.8),d.addRigidBody(f),s.push({body:f,mesh:c}),{body:f,mesh:c}}function D(t){return t*(Math.PI/180)}let i,R,C,J,at,g,Z;const S=[];let k,O,m,P=!1,q=!1,G=!1,B=0,j=0;const At=-50,Q=100,Tt=40,kt=85;let K={x:0,z:0},v=0,Y=!1,_=!1,tt=!1,et=1;const St=.6,Et=1.6;let $,I,W,F;const lt=globalThis.matchMedia("(prefers-color-scheme: dark)");let H=lt.matches;function X(t){i&&(t?(i.background=new o.Color(855309),i.fog=new o.Fog(855309,30,120),it(.25,.8),document.body.style.backgroundColor="#0d0d0d",I.style.color="white",W.style.color="white",F.style.backgroundColor="rgba(0,0,0,0.7)"):(i.background=new o.Color(15790320),i.fog=new o.Fog(15790320,40,180),it(.6,1.2),document.body.style.backgroundColor="#f0f0f0",I.style.color="black",W.style.color="black",F.style.backgroundColor="rgba(255,255,255,0.85)"),It(t))}function it(t,e){for(let s=i.children.length-1;s>=0;s--){const d=i.children[s];d instanceof o.Light&&i.remove(d)}const r=new o.AmbientLight(16777215,t),n=new o.DirectionalLight(16777215,e);n.position.set(20,20,20),n.castShadow=!0,i.add(r),i.add(n)}function It(t){i.traverse(e=>{if(e.isMesh){const n=e.material;if(!n||!n.color)return;n.roughness=t?.9:.5,n.color.offsetHSL(0,0,t?-.25:.25),n.needsUpdate=!0}})}lt.addEventListener("change",t=>{H=t.matches,X(H)});const T={};function dt(){X(H),Wt(),zt(),Ct(),Ft(),Rt(),ht()}function Wt(){i=new o.Scene,i.background=new o.Color(1710618),i.fog=new o.Fog(1710618,50,100),R=new o.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),R.position.set(0,10,20),C=new o.WebGLRenderer({antialias:!0}),C.setSize(innerWidth,innerHeight),C.shadowMap.enabled=!0,document.body.appendChild(C.domElement),i.add(new o.AmbientLight(16777215,.4));const t=new o.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,i.add(t),J=new xt(R,C.domElement),J.enableDamping=!0,at=new o.Clock,addEventListener("resize",()=>{R.aspect=innerWidth/innerHeight,R.updateProjectionMatrix(),C.setSize(innerWidth,innerHeight)})}function zt(){const t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;g=new Ammo.btDiscreteDynamicsWorld(e,r,n,t),g.setGravity(new Ammo.btVector3(0,At,0)),Z=new Ammo.btTransform}function Ct(){const t=document.createElement("div");t.id="power-ui";const e=document.createElement("div");e.id="power-fill",t.appendChild(e),document.body.appendChild(t);const r=document.createElement("div");r.style.position="fixed",r.style.top="20px",r.style.right="20px",r.style.color="white",r.style.fontSize="20px",document.body.appendChild(r);const n=document.createElement("div");n.style.position="fixed",n.style.bottom="20px",n.style.right="20px",n.style.color="white",n.style.fontSize="18px",document.body.appendChild(n);const s=document.createElement("div");s.style.position="fixed",s.style.bottom="50%",s.style.left="50%",s.style.transform="translate(-50%, 50%)",s.style.color="white",s.style.fontSize="24px",s.style.backgroundColor="rgba(0, 0, 0, 0.7)",s.style.padding="15px 30px",s.style.borderRadius="10px",s.style.display="none",s.textContent="Press E to interact",document.body.appendChild(s),$=e,I=r,W=n,F=s,$.style.display="none",I.style.display="block",W.style.display="none",z()}function z(){$.style.height=`${v/Q*100}%`,I.textContent=`Tries: ${B}`,W.textContent||="Mode: NORMAL"}function Rt(){addEventListener("keydown",t=>{const e=t.code;P&&(e==="Space"&&mt()&&(Y=!0),e==="Digit1"&&(et=St,W.textContent="Mode: WEAK"),e==="Digit2"&&(et=Et,W.textContent="Mode: STRONG"))}),addEventListener("keyup",t=>{q&&t.code==="Space"&&Ot()}),addEventListener("keydown",t=>T[t.code]=!0),addEventListener("keyup",t=>T[t.code]=!1)}function vt(){if(!m||q)return;const t=.15;T.KeyW&&(m.position.z-=t),T.KeyS&&(m.position.z+=t),T.KeyA&&(m.position.x-=t),T.KeyD&&(m.position.x+=t);const e=new o.Vector3;T.KeyW&&(e.z-=1),T.KeyS&&(e.z+=1),T.KeyA&&(e.x-=1),T.KeyD&&(e.x+=1),Vt(),Dt()}const ot=[];function nt(t,e=1,r=!1){const n=new o.BoxGeometry(e,e,e),s=new o.MeshStandardMaterial({color:8947848}),d=new o.Mesh(n,s);d.position.set(t.x,t.y??e/2,t.z),d.castShadow=!0,d.receiveShadow=!0,i.add(d);let c;if(r){const a=new Ammo.btBoxShape(new Ammo.btVector3(e/2,e/2,e/2));c=ct(a,0,t,i,S,g).body}const l={mesh:d,body:c,position:d.position.clone(),name:"cube",interactable:!0,pickedUp:!1};return ot.push(l),l}function Gt(){return m?m.position:null}let V=!1;addEventListener("keydown",t=>{t.code==="KeyE"&&(V=!0)});function Bt(){const t=Gt();if(!t){if(F.style.display="none",!V)return;V=!1,console.warn("Pickup attempted but no player/ball present.");return}const e=2.5;let r=!1;for(const s of ot){if(s.pickedUp)continue;const d=s.mesh.position.x-t.x,c=s.mesh.position.y-t.y,l=s.mesh.position.z-t.z;if(Math.sqrt(d*d+c*c+l*l)<=e){r=!0;break}}if(F.style.display=r?"block":"none",!V)return;V=!1;let n=!1;for(const s of ot){if(s.pickedUp)continue;const d=s.mesh.position.x-t.x,c=s.mesh.position.y-t.y,l=s.mesh.position.z-t.z;if(Math.sqrt(d*d+c*c+l*l)<=e){Lt(s),n=!0;break}}n||console.log("No items in range to pick up.")}function Lt(t){if(t.pickedUp=!0,t.interactable=!1,i.remove(t.mesh),t.body){g.removeRigidBody(t.body);const e=S.findIndex(r=>r.body===t.body);if(e!==-1){const r=S[e].mesh;i.remove(r),S.splice(e,1)}Ammo.destroy(t.body)}j++,B++,z(),console.log("Item picked up:",t.name,"| Inventory:",j,"| Tries:",B)}const E={x:0,z:-15,size:5};function Vt(){if(P)return;const t=m.position.x-E.x,e=m.position.z-E.z;t*t+e*e<E.size*E.size&&(P=!0,wt(),ft(),Ht())}const U={x:0,z:-15,size:5};function Dt(){if(q)return;const t=m.position.x-U.x,e=m.position.z-U.z;t*t+e*e<U.size*U.size&&(j===0?(alert("ðŸ’€"),location.reload()):qt())}function mt(){if(!k)return!1;const t=k.getLinearVelocity();return Math.sqrt(t.x()**2+t.y()**2+t.z()**2)<.05&&!G}function Ot(){if(!Y||!k||G)return;Y=!1,tt=v>=kt,_=!0;const t=new o.Vector3;R.getWorldDirection(t),t.y=0,t.normalize();const e=new o.Vector3(-t.z,0,t.x),r=tt?Math.random()*2*(Math.random()<.5?-1:1):0,n=v/Q*120*et,s=new Ammo.btVector3(t.x*n+e.x*r,.15*(v/Q),t.z*n+e.z*r);k.activate(!0),k.applyCentralImpulse(s),B--,z()}function ht(){requestAnimationFrame(ht);const t=at.getDelta();g.stepSimulation(t,10),S.forEach(e=>{const r=e.body.getMotionState();if(r){r.getWorldTransform(Z);const n=Z.getOrigin();e.mesh.position.set(n.x(),n.y(),n.z())}}),q||vt(),Y&&!_&&(v=Math.min(Q,v+Tt*t),z()),_&&mt()&&(_=!1,v=0,tt=!1,z(),B<=0&&!G&&(G=!0,setTimeout(()=>{alert("ðŸ’€"),location.reload()},500))),O&&!G&&Kt(),Bt(),J.update(),C.render(i,R)}function Kt(){const t=O.position.x-K.x,e=O.position.z- -K.z;Math.sqrt(t*t+e*e)<2.5&&O.position.y<-2&&(alert("ðŸŽ‰ You Win!"),G=!0)}function ut(){const t=window;t.Ammo?typeof t.Ammo=="function"?t.Ammo().then(dt):dt():setTimeout(ut,100)}ut();function Ft(){X(H),I.style.display="block",z();const t=8,e=new o.PlaneGeometry(t,t),r=new o.MeshStandardMaterial({color:65280,transparent:!0,opacity:.3,side:o.DoubleSide}),n=new o.Mesh(e,r);n.rotation.x=-Math.PI/2,n.position.set(E.x,.01,E.z),i.add(n);const s=.1,d=new o.BoxGeometry(32,s,32),c=new o.MeshStandardMaterial({color:16777215,roughness:.6}),l=new o.Mesh(d,c);l.position.y=-s/2,l.receiveShadow=!0,i.add(l),nt({x:-12,y:.8,z:-5},1,!0),nt({x:12,y:.8,z:8},1,!0);const a=new o.Shape;a.moveTo(0,1),a.lineTo(-1,-1),a.lineTo(1,-1),a.lineTo(0,1);const u=new o.ExtrudeGeometry(a,{depth:.5,bevelEnabled:!1}),f=new o.MeshStandardMaterial({color:65484});m=new o.Mesh(u,f),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI,m.castShadow=!0,m.position.set(0,1,0),i.add(m);const h=2.5,b=.3,y=new o.MeshStandardMaterial({color:3355443,roughness:.7}),w=new o.BoxGeometry(32,h,b),p=new o.Mesh(w,y);p.position.set(0,h/2,-16),p.castShadow=!0,i.add(p);const x=p.clone();x.position.set(0,h/2,16),i.add(x);const L=new o.BoxGeometry(b,h,32),M=new o.Mesh(L,y);M.position.set(-16,h/2,0),M.castShadow=!0,i.add(M);const A=M.clone();A.position.set(16,h/2,0),i.add(A)}function Ht(){i.background=new o.Color(1710618),i.fog=new o.Fog(1710618,50,100),yt(),I.style.display="block",z();const t=8,e=new o.PlaneGeometry(t,t),r=new o.MeshStandardMaterial({color:15616811,transparent:!0,opacity:.3,side:o.DoubleSide}),n=new o.Mesh(e,r);n.rotation.x=-Math.PI/2,n.position.set(E.x,.01,E.z),i.add(n);const s=.1,d=new o.BoxGeometry(32,s,32),c=new o.MeshStandardMaterial({color:16777215,roughness:.6}),l=new o.Mesh(d,c);l.position.y=-s/2,l.receiveShadow=!0,i.add(l),nt({x:-10,y:.8,z:9},1,!0);const a=new o.Shape;a.moveTo(0,1),a.lineTo(-1,-1),a.lineTo(1,-1),a.lineTo(0,1);const u=new o.ExtrudeGeometry(a,{depth:.5,bevelEnabled:!1}),f=new o.MeshStandardMaterial({color:65484});m=new o.Mesh(u,f),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI,m.castShadow=!0,m.position.set(0,1,0),i.add(m);const h=2.5,b=.3,y=new o.MeshStandardMaterial({color:3355443,roughness:.7}),w=new o.BoxGeometry(32,h,b),p=new o.Mesh(w,y);p.position.set(0,h/2,-16),p.castShadow=!0,i.add(p);const x=p.clone();x.position.set(0,h/2,16),i.add(x);const L=new o.BoxGeometry(b,h,32),M=new o.Mesh(L,y);M.position.set(-16,h/2,0),M.castShadow=!0,i.add(M);const A=M.clone();A.position.set(16,h/2,0),i.add(A)}function qt(){X(H),q=!0,wt(),ft(),yt(),i.background=new o.Color(1710618),i.fog=new o.Fog(1710618,50,100),$.style.display="block",I.style.display="block",W.style.display="block",Nt(),z()}function Nt(){B=j,K={x:0,z:11};const t={x:0,y:2,z:12};Mt({width:4,height:16},{x:0,z:0},{width:1.5,height:1.5},{x:K.x,z:K.z},i,g,0);const e=new Ammo.btSphereShape(1),r=ct(e,1,t,i,S,g);O=r.mesh,k=r.body;const n=1.1;N({width:1,height:2,depth:32},{x:4.5,z:0},i,g,.5,n),N({width:1,height:2,depth:32},{x:-4.5,z:0},i,g,.5,n),N({width:10,height:2,depth:1},{x:0,z:-16.5},i,g,.5,n),N({width:10,height:2,depth:1},{x:0,z:16.5},i,g,.5,n),k.setFriction(2.5),k.setRollingFriction(1.2),k.setDamping(.6,.9)}function wt(){for(;i.children.length>0;){const t=i.children.pop();t&&i.remove(t)}}function ft(){if(g)for(let t=S.length-1;t>=0;t--){const{body:e}=S[t];g.removeRigidBody(e),Ammo.destroy(e),S.splice(t,1)}}function yt(){i.add(new o.AmbientLight(16777215,.4));const t=new o.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,i.add(t)}

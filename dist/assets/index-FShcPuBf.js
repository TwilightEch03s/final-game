import*as o from"https://esm.sh/three@0.181.2";import{OrbitControls as Vt}from"https://esm.sh/three@0.181.2/examples/jsm/controls/OrbitControls.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();function M(t,e,i,n,r=0,a=1.1,h=0,m=6710886){const d=new o.Mesh(new o.BoxGeometry(t.width,t.height,t.depth),new o.MeshStandardMaterial({color:m}));d.position.set(e.x,r,e.z),d.rotation.x=Y(h),i.add(d);const l=new o.Mesh(new o.BoxGeometry(t.width,t.height,t.depth),new o.MeshStandardMaterial({color:0,wireframe:!0}));l.position.set(e.x,r,e.z),l.rotation.x=Y(h),i.add(l);const g=new Ammo.btQuaternion;g.setRotation(new Ammo.btVector3(1,0,0),Y(h));const p=new Ammo.btTransform;p.setIdentity(),p.setRotation(g),p.setOrigin(new Ammo.btVector3(e.x,r,e.z));const k=new Ammo.btBoxShape(new Ammo.btVector3(t.width/2,t.height/2,t.depth/2)),c=new Ammo.btDefaultMotionState(p),u=new Ammo.btVector3(0,0,0);k.calculateLocalInertia(0,u);const A=new Ammo.btRigidBodyConstructionInfo(0,c,k,u),S=new Ammo.btRigidBody(A);return S.setRestitution(a),n.addRigidBody(S),S}function Wt(t,e,i,n,r,a,h=0,m=0){const d=new o.Shape;d.moveTo(-t.width+e.x,-16+e.z),d.lineTo(t.width+e.x,-16+e.z),d.lineTo(t.width+e.x,t.height+e.z),d.lineTo(-t.width+e.x,t.height+e.z),d.lineTo(-t.width+e.x,-16+e.z);const l=new o.Path;l.moveTo(-1.5+n.x,-i.height+n.z),l.lineTo(i.width+n.x,-i.height+n.z),l.lineTo(i.width+n.x,i.height+n.z),l.lineTo(-1.5+n.x,i.height+n.z),l.lineTo(-1.5+n.x,-i.height+n.z),d.holes.push(l);const g=new o.ShapeGeometry(d),p=new o.MeshStandardMaterial({color:10066329,side:o.DoubleSide}),k=new o.Mesh(g,p);k.rotation.x=-Math.PI/2+Y(m),k.position.y=h,r.add(k);const c=new Ammo.btCompoundShape,u=new Ammo.btTransform;u.setIdentity();const A=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(n.z-e.z+(t.height-i.height))/2,.1));u.setOrigin(new Ammo.btVector3(e.x,(e.z+n.z-t.height-i.height)/2,h)),c.addChildShape(u,A);const S=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(t.height-i.height-(n.z-e.z))/2,.1));u.setOrigin(new Ammo.btVector3(e.x,(t.height+i.height+e.z+n.z)/2,h)),c.addChildShape(u,S);const C=new Ammo.btBoxShape(new Ammo.btVector3((n.x-e.x+(t.width-i.width))/2,i.height,.1));u.setOrigin(new Ammo.btVector3((e.x+n.x-t.width-i.width)/2,n.z,h)),c.addChildShape(u,C);const w=new Ammo.btBoxShape(new Ammo.btVector3((t.width-i.width-(n.x-e.x))/2,i.height,.1));u.setOrigin(new Ammo.btVector3((e.x+n.x+i.width+t.width)/2,n.z,h)),c.addChildShape(u,w);const v=new Ammo.btTransform;v.setIdentity();const L=new Ammo.btQuaternion;L.setRotation(new Ammo.btVector3(1,0,0),-Math.PI/2+Y(m)),v.setRotation(L),v.setOrigin(new Ammo.btVector3(0,0,0));const J=new Ammo.btDefaultMotionState(v),Ct=new Ammo.btVector3(0,0,0),Gt=new Ammo.btRigidBodyConstructionInfo(0,J,c,Ct),pt=new Ammo.btRigidBody(Gt);return a.addRigidBody(pt),pt}function gt(t,e,i,n,r,a){const h=t instanceof Ammo.btSphereShape?new o.Mesh(new o.SphereGeometry(1,32,32),new o.MeshStandardMaterial({color:10066329})):new o.Mesh(new o.BoxGeometry(1.5,1.5,1.5),new o.MeshStandardMaterial({color:6710886}));h.position.set(i.x,i.y,i.z),n.add(h);const m=new Ammo.btTransform;m.setIdentity(),m.setOrigin(new Ammo.btVector3(i.x,i.y,i.z));const d=new Ammo.btDefaultMotionState(m),l=new Ammo.btVector3(0,0,0);e&&t.calculateLocalInertia(e,l);const g=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(e,d,t,l));return g.setRestitution(.8),a.addRigidBody(g),r.push({body:g,mesh:h}),{body:g,mesh:h}}function Y(t){return t*(Math.PI/180)}let s,V,N,lt,xt,f,ht;const R=[];let x,b,P=new o.Vector3(0,2,14),y,B=!1,W=!1,K=!1,T=1,F=1;const Lt=-50,et=100,Rt=40,Bt=85;let X={x:0,z:0},$=0,ot=!1,j=!1,mt=!1,tt=1;const Ot=.6,Ht=1,Kt=1.6;let nt,E,I,U,bt="en";const Nt={en:{tries:"Tries",instructions:`Use WASD to move. Use E to interact with blocks.
In golf mode, hold SPACE to power up your hit and move the camera to aim.
Press '4' to save the game and '5' to reset.
Press '6' for English, '7' for Chinese, '8' for Arabic.`,mode:"Mode",weak:"WEAK",normal:"NORMAL",strong:"STRONG",interact:"Press E to interact",win:"ðŸŽ‰ You Win!",lose:"ðŸ’€"},zh:{tries:"æ¬¡æ•°",instructions:`ä½¿ç”¨ WASD ç§»åŠ¨ï¼ŒæŒ‰ E ä¸Žç‰©ä½“äº’åŠ¨ã€‚
åœ¨é«˜å°”å¤«æ¨¡å¼ä¸­ï¼ŒæŒ‰ä½ ç©ºæ ¼ é”® è“„åŠ›å¹¶è½¬åŠ¨é•œå¤´çž„å‡†ã€‚
æŒ‰ 4 ä¿å­˜æ¸¸æˆï¼ŒæŒ‰ 5 é‡ç½®æ¸¸æˆã€‚
æŒ‰ 6 ä¸ºè‹±è¯­ï¼Œ7 ä¸ºä¸­æ–‡ï¼Œ8 ä¸ºé˜¿æ‹‰ä¼¯è¯­ã€‚`,mode:"æ¨¡å¼",weak:"å¼±",normal:"æ­£å¸¸",strong:"å¼º",interact:"æŒ‰ E é”®äº’åŠ¨",win:"ðŸŽ‰ ä½ èµ¢äº†ï¼",lose:"ðŸ’€"},ar:{tries:"Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª",instructions:`Ø§Ø³ØªØ®Ø¯Ù… WASD Ù„Ù„Ø­Ø±ÙƒØ© ÙˆØ§Ø¶ØºØ· E Ù„Ù„ØªÙØ§Ø¹Ù„.
ÙÙŠ ÙˆØ¶Ø¹ Ø§Ù„Ø¬ÙˆÙ„Ù Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆØ§Ø¶Ø¨Ø· Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„Ù„ØªØµÙˆÙŠØ¨.
Ø§Ø¶ØºØ· 4 Ù„Ù„Ø­ÙØ¸ Ùˆ5 Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†.
Ø§Ø¶ØºØ· 6 Ù„Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ùˆ7 Ù„Ù„ØµÙŠÙ†ÙŠØ© Ùˆ8 Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©.`,mode:"Ø§Ù„ÙˆØ¶Ø¹",weak:"Ø¶Ø¹ÙŠÙ",normal:"Ø¹Ø§Ø¯ÙŠ",strong:"Ù‚ÙˆÙŠ",interact:"Ø§Ø¶ØºØ· E Ù„Ù„ØªÙØ§Ø¹Ù„",win:"ðŸŽ‰ ÙØ²Øª!",lose:"ðŸ’€"}};function z(t){return Nt[bt][t]}function ct(t){bt=t,U.textContent=z("interact");const e=document.getElementById("instructions");e&&(e.innerText=z("instructions")),I.textContent=`${z("mode")}: ${z("normal")}`,D(),$t(t)}function $t(t){t==="ar"?(document.body.dir="rtl",E.style.right="auto",E.style.left="20px",I.style.right="auto",I.style.left="20px"):(document.body.dir="ltr",E.style.left="auto",E.style.right="20px",I.style.left="auto",I.style.right="20px")}const Mt=globalThis.matchMedia("(prefers-color-scheme: dark)");let O=Mt.matches;function st(t){s&&(t?(s.background=new o.Color(4013373),s.fog=new o.Fog(855309,30,120),wt(.25,.8),document.body.style.backgroundColor="#0d0d0d",E.style.color="white",I.style.color="white",U.style.backgroundColor="rgba(0,0,0,0.7)"):(s.background=new o.Color(15790320),s.fog=new o.Fog(15790320,40,180),wt(.6,1.2),document.body.style.backgroundColor="#f0f0f0",E.style.color="black",I.style.color="black",U.style.backgroundColor="rgba(255,255,255,0.85)"),Ft(t))}function wt(t,e){for(let r=s.children.length-1;r>=0;r--){const a=s.children[r];a instanceof o.Light&&s.remove(a)}const i=new o.AmbientLight(16777215,t),n=new o.DirectionalLight(16777215,e);n.position.set(20,20,20),n.castShadow=!0,s.add(i),s.add(n)}function Ft(t){s.traverse(e=>{if(e.isMesh){const n=e.material;if(!n||!n.color)return;n.roughness=t?.9:.5,n.color.offsetHSL(0,0,t?-.25:.25),n.needsUpdate=!0}})}Mt.addEventListener("change",t=>{O=t.matches,st(O)});const G={};function yt(){st(O),_t(),Jt(),Ut(),Pt(),qt(),Qt(),zt()}function _(){localStorage.world0=B,localStorage.world1=W,localStorage.tries=T,localStorage.inventory=F,localStorage.pickedItems=JSON.stringify(q),console.log(JSON.parse(localStorage.pickedItems)),console.log(localStorage)}function At(){localStorage.clear(),location.reload()}function Ut(){localStorage.length!=0&&(B=JSON.parse(localStorage.world0),W=JSON.parse(localStorage.world1),T=localStorage.tries,F=localStorage.inventory,q=JSON.parse(localStorage.pickedItems),console.log(localStorage))}function qt(){if((B&&W)==!0){Dt();return}B&&Et(),!B&&!W&&Tt()}function _t(){s=new o.Scene,V=new o.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),V.position.set(0,10,20),N=new o.WebGLRenderer({antialias:!0}),N.setSize(innerWidth,innerHeight),N.shadowMap.enabled=!0,document.body.appendChild(N.domElement),s.add(new o.AmbientLight(16777215,.4));const t=new o.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,s.add(t),lt=new Vt(V,N.domElement),lt.enableDamping=!0,xt=new o.Clock,addEventListener("resize",()=>{V.aspect=innerWidth/innerHeight,V.updateProjectionMatrix(),N.setSize(innerWidth,innerHeight)})}function Jt(){const t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),i=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;f=new Ammo.btDiscreteDynamicsWorld(e,i,n,t),f.setGravity(new Ammo.btVector3(0,Lt,0)),ht=new Ammo.btTransform}function Pt(){const t=document.createElement("div");t.id="power-ui";const e=document.createElement("div");e.id="power-fill",t.appendChild(e),document.body.appendChild(t);const i=document.createElement("div");i.style.position="fixed",i.style.top="20px",i.style.right="20px",i.style.color="white",i.style.fontSize="20px",document.body.appendChild(i);const n=document.createElement("div");n.style.position="fixed",n.style.top="20px",n.style.left="20px",n.style.color="white",n.style.fontSize="20px",n.id="instructions",n.innerText=z("instructions"),document.body.appendChild(n);const r=document.createElement("div");r.style.position="fixed",r.style.bottom="20px",r.style.right="20px",r.style.color="white",r.style.fontSize="18px",document.body.appendChild(r);const a=document.createElement("div");a.style.position="fixed",a.style.bottom="50%",a.style.left="50%",a.style.transform="translate(-50%, 50%)",a.style.color="white",a.style.fontSize="24px",a.style.backgroundColor="rgba(0, 0, 0, 0.7)",a.style.padding="15px 30px",a.style.borderRadius="10px",a.style.display="none",a.textContent=z("interact"),document.body.appendChild(a),nt=e,E=i,I=r,U=a,nt.style.display="none",E.style.display="block",I.style.display="none",D()}function D(){nt.style.height=`${$/et*100}%`,E.textContent=`${z("tries")}: ${T}`,I.textContent||=`${z("mode")}: ${z("normal")}`}function Qt(){addEventListener("keydown",t=>{t.code==="KeyU"&&de(),t.code==="Digit4"&&_(),t.code==="Digit5"&&At(),t.code==="Digit6"&&ct("en"),t.code==="Digit7"&&ct("zh"),t.code==="Digit8"&&ct("ar");const e=t.code;G[e]=!0,B&&(e==="Space"&&St()&&(ot=!0),e==="Digit1"&&(tt=Ot,I.textContent=`${z("mode")}: ${z("weak")}`),e==="Digit2"&&(tt=Ht,I.textContent=`${z("mode")}: ${z("normal")}`),e==="Digit3"&&(tt=Kt,I.textContent=`${z("mode")}: ${z("strong")}`))}),addEventListener("keyup",t=>{G[t.code]=!1,W&&t.code==="Space"&&oe()})}function Yt(){if(!y||W){console.log("???");return}const t=.15;G.KeyW&&(y.position.z-=t),G.KeyS&&(y.position.z+=t),G.KeyA&&(y.position.x-=t),G.KeyD&&(y.position.x+=t);const e=new o.Vector3;G.KeyW&&(e.z-=1),G.KeyS&&(e.z+=1),G.KeyA&&(e.x-=1),G.KeyD&&(e.x+=1),te(),ee()}const it=[];let q=[];function rt(t,e=1,i=!1){for(const d of q)if(d.position.x==t.x)return;for(const d of it)if(d.position.x==t.x&&d.position.z==t.z&&!d.pickedUp){s.add(d.mesh);return}const n=new o.BoxGeometry(e,e,e),r=new o.MeshStandardMaterial({color:8947848}),a=new o.Mesh(n,r);a.position.set(t.x,t.y??e/2,t.z),a.castShadow=!0,a.receiveShadow=!0,s.add(a);let h;if(i){const d=new Ammo.btBoxShape(new Ammo.btVector3(e/2,e/2,e/2));h=gt(d,0,t,s,R,f).body}const m={mesh:a,body:h,position:a.position.clone(),name:"cube",interactable:!0,pickedUp:!1};return it.push(m),m}function Xt(){return y?y.position:null}let Q=!1;addEventListener("keydown",t=>{t.code==="KeyE"&&(Q=!0)});function Zt(){const t=Xt();if(!t){if(U.style.display="none",!Q)return;Q=!1,console.warn("Pickup attempted but no player/ball present.");return}const e=2.5;let i=!1;for(const r of it){if(r.pickedUp)continue;const a=r.mesh.position.x-t.x,h=r.mesh.position.y-t.y,m=r.mesh.position.z-t.z;if(Math.sqrt(a*a+h*h+m*m)<=e){i=!0;break}}if(U.style.display=i?"block":"none",!Q)return;Q=!1;let n=!1;for(const r of it){if(r.pickedUp)continue;const a=r.mesh.position.x-t.x,h=r.mesh.position.y-t.y,m=r.mesh.position.z-t.z;if(Math.sqrt(a*a+h*h+m*m)<=e){jt(r),n=!0;break}}n||console.log("No items in range to pick up.")}function jt(t){if(q.push(t),t.pickedUp=!0,t.interactable=!1,s.remove(t.mesh),t.body){f.removeRigidBody(t.body);const e=R.findIndex(i=>i.body===t.body);if(e!==-1){const i=R[e].mesh;s.remove(i),R.splice(e,1)}Ammo.destroy(t.body)}F++,T++,D(),at.push(se(t)),console.log("Item picked up:",t.name,"| Inventory:",F,"| Tries:",T)}const H={x:0,z:-15,size:5};function te(){if(B)return;const t=y.position.x-H.x,e=y.position.z-H.z;t*t+e*e<H.size*H.size&&(at.push(ce()),B=!0,_(),ft(),ut(),Et())}const Z={x:0,z:-15,size:5};let dt=!1;function ee(){if(W)return;const t=y.position.x-Z.x,e=y.position.z-Z.z;t*t+e*e<Z.size*Z.size&&(F===0&&!dt?(alert(z("lose")),location.reload(),dt=!0):dt?At():Dt())}function St(){if(!x)return!1;const t=x.getLinearVelocity();return Math.sqrt(t.x()**2+t.y()**2+t.z()**2)<.05&&!K}function oe(){if(!ot||!x||K)return;const t=b.position.clone(),e=x.getLinearVelocity(),i=new o.Vector3(e.x(),e.y(),e.z()),n=T;at.push(ae(t,i,n)),P.copy(b.position),ot=!1,mt=$>=Bt,j=!0;const r=new o.Vector3;V.getWorldDirection(r),r.y=0,r.normalize();const a=new o.Vector3(-r.z,0,r.x),h=mt?Math.random()*2*(Math.random()<.5?-1:1):0,m=$/et*120*tt,d=new Ammo.btVector3(r.x*m+a.x*h,.15*($/et),r.z*m+a.z*h);x.activate(!0),x.applyCentralImpulse(d),T--,D()}function zt(){requestAnimationFrame(zt);const t=xt.getDelta();if(f.stepSimulation(t,10),R.forEach(e=>{const i=e.body.getMotionState();if(i){i.getWorldTransform(ht);const n=ht.getOrigin();e.mesh.position.set(n.x(),n.y(),n.z())}}),b&&x&&W){const e=x.getLinearVelocity(),i=Math.sqrt(e.x()**2+e.z()**2);if(i>.1){const n=i*2,r=new o.Vector2(e.x(),e.z()).normalize();b.rotateOnAxis(new o.Vector3(-r.y,0,r.x),n*t)}}W||Yt(),ot&&!j&&($=Math.min(et,$+Rt*t),D()),j&&St()&&(j=!1,$=0,mt=!1,D(),T<=0&&!K&&(K=!0,setTimeout(()=>{vt()},500))),b&&!K&&(ne(),ie()),Zt(),lt.update(),N.render(s,V)}function ne(){const t=b.position.x-X.x,e=b.position.z- -X.z;Math.sqrt(t*t+e*e)<2.5&&b.position.y<-2&&(alert(z("win")),K=!0)}function ie(){if(b.position.y<-10){b.position.copy(P);const e=new Ammo.btTransform;e.setIdentity(),e.setOrigin(new Ammo.btVector3(P.x,P.y,P.z)),x.setWorldTransform(e),x.setLinearVelocity(new Ammo.btVector3(0,0,0)),x.setAngularVelocity(new Ammo.btVector3(0,0,0)),x.activate(!0),T--,D(),T<=0&&!K&&(K=!0,setTimeout(()=>{vt()},500))}}function vt(){if(!b)return;const t=b.position.clone(),e=200,i=[],n=[];for(let c=0;c<e;c++){const u=Math.random()*1.5+.3,A=new o.SphereGeometry(u,8,8),S=Math.random()>.6,C=new o.MeshStandardMaterial({color:S?3355443:Math.random()>.5?16729344:16747520,emissive:S?0:16729344,emissiveIntensity:S?0:1.5}),w=new o.Mesh(A,C);w.position.copy(t);const v=Math.random()*Math.PI*2,L=Math.random()*Math.PI-Math.PI/2,J=Math.random()*30+10;w.userData.velocity=new o.Vector3(Math.cos(v)*Math.cos(L)*J,Math.sin(L)*J+15,Math.sin(v)*Math.cos(L)*J),w.userData.isSmoke=S,s.add(w),i.push(w)}const r=[];s.traverse(c=>{if(c.isMesh&&c!==b){const u=c;u.geometry&&u.material&&r.push(u)}}),r.forEach(c=>{const u=c.position.distanceTo(t);if(u<100){const A=Math.random()*2+.5,S=new o.BoxGeometry(A,A,A),C=c.material.clone();C.emissive=new o.Color(16729344),C.emissiveIntensity=.5;const w=new o.Mesh(S,C);w.position.copy(c.position);const v=c.position.clone().sub(t).normalize(),L=(100-u)*.5;w.userData.velocity=new o.Vector3(v.x*L+(Math.random()-.5)*20,Math.random()*25+20,v.z*L+(Math.random()-.5)*20),w.userData.rotationSpeed=new o.Vector3((Math.random()-.5)*10,(Math.random()-.5)*10,(Math.random()-.5)*10),s.add(w),n.push(w),c.visible=!1}}),b.visible=!1;const a=s.background;s.background=new o.Color(16777215);const h=new o.RingGeometry(.1,1,32),m=new o.MeshBasicMaterial({color:16729344,transparent:!0,opacity:1,side:o.DoubleSide}),d=new o.Mesh(h,m);d.position.copy(t),d.rotation.x=-Math.PI/2,s.add(d);const l=V.position.clone();let g=0,p=1;const k=setInterval(()=>{if(g+=.016,g<1){const c=Math.max(0,1-g)*2;V.position.set(l.x+(Math.random()-.5)*c,l.y+(Math.random()-.5)*c,l.z+(Math.random()-.5)*c)}else V.position.copy(l);p<100&&(p+=3,d.scale.set(p,p,1),m.opacity=Math.max(0,1-p/100)),i.forEach(c=>{c.position.add(c.userData.velocity.clone().multiplyScalar(.016)),c.userData.velocity.y-=30*.016;const u=c.material;c.userData.isSmoke?(u.opacity=Math.max(0,1-g*.5),c.scale.multiplyScalar(1.02)):(u.opacity=Math.max(0,1-g*1.5),c.scale.multiplyScalar(.97)),u.transparent=!0}),n.forEach(c=>{c.position.add(c.userData.velocity.clone().multiplyScalar(.016)),c.userData.velocity.y-=40*.016,c.rotation.x+=c.userData.rotationSpeed.x*.016,c.rotation.y+=c.userData.rotationSpeed.y*.016,c.rotation.z+=c.userData.rotationSpeed.z*.016;const u=c.material;u.opacity=Math.max(0,1-g*.8),u.transparent=!0}),g>.15&&(s.background=a),g>3&&(clearInterval(k),i.forEach(c=>s.remove(c)),n.forEach(c=>s.remove(c)),s.remove(d),setTimeout(()=>{alert("ðŸ’€"),location.reload()},500))},16)}function kt(){const t=window;t.Ammo?typeof t.Ammo=="function"?t.Ammo().then(yt):yt():setTimeout(kt,100)}kt();function ut(){if(f)for(let t=R.length-1;t>=0;t--){const{body:e}=R[t];f.removeRigidBody(e),Ammo.destroy(e),R.splice(t,1)}}function It(){s.add(new o.AmbientLight(16777215,.4));const t=new o.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,s.add(t)}function ft(){for(;s.children.length>0;){const t=s.children.pop();t&&s.remove(t)}}function Tt(){E.style.display="block",D();const t=8,e=new o.PlaneGeometry(t,t),i=new o.MeshStandardMaterial({color:65280,transparent:!0,opacity:.3,side:o.DoubleSide}),n=new o.Mesh(e,i);n.rotation.x=-Math.PI/2,n.position.set(H.x,.01,H.z),s.add(n);const r=.1,a=new o.BoxGeometry(32,r,32),h=new o.MeshStandardMaterial({color:16777215,roughness:.6}),m=new o.Mesh(a,h);m.position.y=-r/2,m.receiveShadow=!0,s.add(m),rt({x:-12,y:.8,z:-5},1,!0),rt({x:12,y:.8,z:8},1,!0);const d=new o.Shape;d.moveTo(0,1),d.lineTo(-1,-1),d.lineTo(1,-1),d.lineTo(0,1);const l=new o.ExtrudeGeometry(d,{depth:.5,bevelEnabled:!1}),g=new o.MeshStandardMaterial({color:65484});y=new o.Mesh(l,g),y.rotation.x=Math.PI/2,y.rotation.z=Math.PI,y.castShadow=!0,y.position.set(0,1,0),s.add(y);const p=2.5,k=.3,c=new o.MeshStandardMaterial({color:O?3355443:14540253,roughness:O?.8:.4}),u=new o.BoxGeometry(32,p,k),A=new o.Mesh(u,c);A.position.set(0,p/2,-16),A.castShadow=!0,s.add(A);const S=A.clone();S.position.set(0,p/2,16),s.add(S);const C=new o.BoxGeometry(k,p,32),w=new o.Mesh(C,c);w.position.set(-16,p/2,0),w.castShadow=!0,s.add(w);const v=w.clone();v.position.set(16,p/2,0),s.add(v),st(O)}function Et(){It(),E.style.display="block",D();const t=8,e=new o.PlaneGeometry(t,t),i=new o.MeshStandardMaterial({color:15616811,transparent:!0,opacity:.3,side:o.DoubleSide}),n=new o.Mesh(e,i);n.rotation.x=-Math.PI/2,n.position.set(H.x,.01,H.z),s.add(n);const r=.1,a=new o.BoxGeometry(32,r,32),h=new o.MeshStandardMaterial({color:16777215,roughness:.6}),m=new o.Mesh(a,h);m.position.y=-r/2,m.receiveShadow=!0,s.add(m),rt({x:-10,y:.8,z:9},1,!0);const d=new o.Shape;d.moveTo(0,1),d.lineTo(-1,-1),d.lineTo(1,-1),d.lineTo(0,1);const l=new o.ExtrudeGeometry(d,{depth:.5,bevelEnabled:!1}),g=new o.MeshStandardMaterial({color:65484});y=new o.Mesh(l,g),y.rotation.x=Math.PI/2,y.rotation.z=Math.PI,y.castShadow=!0,y.position.set(0,1,0),s.add(y);const p=2.5,k=.3,c=new o.MeshStandardMaterial({color:O?3355443:14540253,roughness:O?.8:.4}),u=new o.BoxGeometry(32,p,k),A=new o.Mesh(u,c);A.position.set(0,p/2,-16),A.castShadow=!0,s.add(A);const S=A.clone();S.position.set(0,p/2,16),s.add(S);const C=new o.BoxGeometry(k,p,32),w=new o.Mesh(C,c);w.position.set(-16,p/2,0),w.castShadow=!0,s.add(w);const v=w.clone();v.position.set(16,p/2,0),s.add(v)}function Dt(){W=!0,_(),ft(),ut(),It(),nt.style.display="block",E.style.display="block",I.style.display="block",re(),D(),st(O)}function re(){T=F,X={x:0,z:11};const t={x:0,y:2,z:14};Wt({width:4,height:16},{x:0,z:0},{width:1.5,height:1.5},{x:X.x,z:X.z},s,f,0);const e=new Ammo.btSphereShape(1),i=gt(e,1,t,s,R,f);b=i.mesh,x=i.body,b.material.color.setHex(1710618),b.material.metalness=.3,b.material.roughness=.7;const n=new o.CylinderGeometry(.1,.1,.6,8),r=new o.MeshStandardMaterial({color:9127187,roughness:.9}),a=new o.Mesh(n,r);a.position.set(0,1.3,0),b.add(a);const h=new o.SphereGeometry(.15,8,8),m=new o.MeshStandardMaterial({color:16729344,emissive:16729344,emissiveIntensity:1}),d=new o.Mesh(h,m);d.position.set(0,1.6,0),b.add(d);const l=1.1;M({width:1,height:2,depth:32},{x:4.5,z:0},s,f,.5,l),M({width:1,height:2,depth:32},{x:-12.5,z:0},s,f,.5,l),M({width:1,height:10,depth:24},{x:-4.5,z:-5},s,f,.5,l),M({width:1,height:10,depth:24},{x:-12.5,z:-5},s,f,.5,l),M({width:10,height:10,depth:1},{x:0,z:-16.5},s,f,.5,l),M({width:26,height:20,depth:1},{x:0,z:-27.5},s,f,.5,l),M({width:8,height:10,depth:1},{x:8,z:-3},s,f,.5,l),M({width:10,height:2,depth:1},{x:0,z:-6},s,f,.5,l),M({width:10,height:2,depth:1},{x:0,z:16.5},s,f,.5,l),M({width:18,height:2,depth:1},{x:-4,z:16.5},s,f,.5,l),M({width:1,height:7.25,depth:13},{x:4.5,z:-10},s,f,.5,l),M({width:1,height:10,depth:14.5},{x:12.5,z:-9.75},s,f,.5,l),M({width:1,height:20,depth:10},{x:12.5,z:-22},s,f,.5,l),M({width:1,height:20,depth:10},{x:-12.5,z:-22},s,f,.5,l),M({width:9,height:0,depth:10},{x:-8.5,z:11},s,f,.001,l,0,11119017),M({width:9,height:0,depth:10},{x:-8.5,z:1.75},s,f,2,0,25,11119017),M({width:9,height:0,depth:14.25},{x:-8.5,z:-9.9},s,f,4.1,l,0,11119017),M({width:26,height:0,depth:10},{x:0,z:-22},s,f,4.1,l,0,11119017),M({width:9,height:0,depth:14.25},{x:8.5,z:-9.9},s,f,4.1,l,0,11119017),M({width:2,height:1,depth:2},{x:4.5,z:-22},s,f,4.5,4,0,16711680),M({width:2,height:1,depth:2},{x:-4.5,z:-22},s,f,4.5,4,0,16711680),x.setFriction(2.5),x.setRollingFriction(1.2),x.setDamping(.6,.9)}const at=[];function se(t){return{undo:()=>{const e=q.indexOf(t);e!==-1&&q.splice(e,1),rt({x:t.position.x,y:t.position.y,z:t.position.z},1,!0),F--,T--,D(),_()}}}function ae(t,e,i){return{undo:()=>{if(!x||!b)return;T=i,D(),_();const n=new Ammo.btTransform;n.setIdentity(),n.setOrigin(new Ammo.btVector3(t.x,t.y,t.z)),x.setWorldTransform(n),x.getMotionState()?.setWorldTransform(n);const r=new Ammo.btVector3(e.x,e.y,e.z);x.setLinearVelocity(r),x.setAngularVelocity(new Ammo.btVector3(0,0,0)),x.activate(!0),b.position.copy(t),console.log("Ball undo")}}}function ce(){return{undo:()=>{B=!1,_(),ft(),ut(),Tt()}}}function de(){const t=at.pop();t&&t.undo()}

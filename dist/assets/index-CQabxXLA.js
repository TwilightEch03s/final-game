import*as o from"https://esm.sh/three@0.181.2";import{OrbitControls as Tt}from"https://esm.sh/three@0.181.2/examples/jsm/controls/OrbitControls.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(s){if(s.ep)return;s.ep=!0;const c=r(s);fetch(s.href,c)}})();function U(t,e,r,n,s=0,c=1.1,a=0,l=6710886){const d=new o.Mesh(new o.BoxGeometry(t.width,t.height,t.depth),new o.MeshStandardMaterial({color:l}));d.position.set(e.x,s,e.z),d.rotation.x=K(a),r.add(d);const u=new o.Mesh(new o.BoxGeometry(t.width,t.height,t.depth),new o.MeshStandardMaterial({color:0,wireframe:!0}));u.position.set(e.x,s,e.z),u.rotation.x=K(a),r.add(u);const w=new Ammo.btQuaternion;w.setRotation(new Ammo.btVector3(1,0,0),K(a));const h=new Ammo.btTransform;h.setIdentity(),h.setRotation(w),h.setOrigin(new Ammo.btVector3(e.x,s,e.z));const b=new Ammo.btBoxShape(new Ammo.btVector3(t.width/2,t.height/2,t.depth/2)),y=new Ammo.btDefaultMotionState(h),f=new Ammo.btVector3(0,0,0);b.calculateLocalInertia(0,f);const p=new Ammo.btRigidBodyConstructionInfo(0,y,b,f),A=new Ammo.btRigidBody(p);return A.setRestitution(c),n.addRigidBody(A),A}function kt(t,e,r,n,s,c,a=0,l=0){const d=new o.Shape;d.moveTo(-t.width+e.x,-16+e.z),d.lineTo(t.width+e.x,-16+e.z),d.lineTo(t.width+e.x,t.height+e.z),d.lineTo(-t.width+e.x,t.height+e.z),d.lineTo(-t.width+e.x,-16+e.z);const u=new o.Path;u.moveTo(-1.5+n.x,-r.height+n.z),u.lineTo(r.width+n.x,-r.height+n.z),u.lineTo(r.width+n.x,r.height+n.z),u.lineTo(-1.5+n.x,r.height+n.z),u.lineTo(-1.5+n.x,-r.height+n.z),d.holes.push(u);const w=new o.ShapeGeometry(d),h=new o.MeshStandardMaterial({color:10066329,side:o.DoubleSide}),b=new o.Mesh(w,h);b.rotation.x=-Math.PI/2+K(l),b.position.y=a,s.add(b);const y=new Ammo.btCompoundShape,f=new Ammo.btTransform;f.setIdentity();const p=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(n.z-e.z+(t.height-r.height))/2,.1));f.setOrigin(new Ammo.btVector3(e.x,(e.z+n.z-t.height-r.height)/2,a)),y.addChildShape(f,p);const A=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(t.height-r.height-(n.z-e.z))/2,.1));f.setOrigin(new Ammo.btVector3(e.x,(t.height+r.height+e.z+n.z)/2,a)),y.addChildShape(f,A);const V=new Ammo.btBoxShape(new Ammo.btVector3((n.x-e.x+(t.width-r.width))/2,r.height,.1));f.setOrigin(new Ammo.btVector3((e.x+n.x-t.width-r.width)/2,n.z,a)),y.addChildShape(f,V);const T=new Ammo.btBoxShape(new Ammo.btVector3((t.width-r.width-(n.x-e.x))/2,r.height,.1));f.setOrigin(new Ammo.btVector3((e.x+n.x+r.width+t.width)/2,n.z,a)),y.addChildShape(f,T);const k=new Ammo.btTransform;k.setIdentity();const it=new Ammo.btQuaternion;it.setRotation(new Ammo.btVector3(1,0,0),-Math.PI/2+K(l)),k.setRotation(it),k.setOrigin(new Ammo.btVector3(0,0,0));const xt=new Ammo.btDefaultMotionState(k),Mt=new Ammo.btVector3(0,0,0),At=new Ammo.btRigidBodyConstructionInfo(0,xt,y,Mt),ct=new Ammo.btRigidBody(At);return c.addRigidBody(ct),ct}function lt(t,e,r,n,s,c){const a=t instanceof Ammo.btSphereShape?new o.Mesh(new o.SphereGeometry(1,32,32),new o.MeshStandardMaterial({color:10066329})):new o.Mesh(new o.BoxGeometry(1.5,1.5,1.5),new o.MeshStandardMaterial({color:6710886}));a.position.set(r.x,r.y,r.z),n.add(a);const l=new Ammo.btTransform;l.setIdentity(),l.setOrigin(new Ammo.btVector3(r.x,r.y,r.z));const d=new Ammo.btDefaultMotionState(l),u=new Ammo.btVector3(0,0,0);e&&t.calculateLocalInertia(e,u);const w=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(e,d,t,u));return w.setRestitution(.8),c.addRigidBody(w),s.push({body:w,mesh:a}),{body:w,mesh:a}}function K(t){return t*(Math.PI/180)}let i,v,R,P,mt,g,tt;const E=[];let C,F,m,et=!1,N=!1,L=!1,B=0,j=0;const St=-50,Q=100,zt=40,Ct=85;let H={x:0,z:0},G=0,Y=!1,$=!1,ot=!1,nt=1;const Et=.6,It=1.6;let X,x,M,D,ht="en";const Wt={en:{tries:"Tries",mode:"Mode",weak:"WEAK",strong:"STRONG",interact:"Press E to interact",win:"ðŸŽ‰ You Win!",lose:"ðŸ’€"},zh:{tries:"æ¬¡æ•°",mode:"æ¨¡å¼",weak:"å¼±",strong:"å¼º",interact:"æŒ‰ E é”®äº’åŠ¨",win:"ðŸŽ‰ ä½ èµ¢äº†ï¼",lose:"ðŸ’€"},ar:{tries:"Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª",mode:"Ø§Ù„ÙˆØ¶Ø¹",weak:"Ø¶Ø¹ÙŠÙ",strong:"Ù‚ÙˆÙŠ",interact:"Ø§Ø¶ØºØ· E Ù„Ù„ØªÙØ§Ø¹Ù„",win:"ðŸŽ‰ ÙØ²Øª!",lose:"ðŸ’€"}};function z(t){return Wt[ht][t]}function Z(t){ht=t,D.textContent=z("interact"),I(),Rt(t)}function Rt(t){t==="ar"?(document.body.dir="rtl",x.style.right="auto",x.style.left="20px",M.style.right="auto",M.style.left="20px"):(document.body.dir="ltr",x.style.left="auto",x.style.right="20px",M.style.left="auto",M.style.right="20px")}const ut=globalThis.matchMedia("(prefers-color-scheme: dark)");let q=ut.matches;function J(t){i&&(t?(i.background=new o.Color(855309),i.fog=new o.Fog(855309,30,120),at(.25,.8),document.body.style.backgroundColor="#0d0d0d",x.style.color="white",M.style.color="white",D.style.backgroundColor="rgba(0,0,0,0.7)"):(i.background=new o.Color(15790320),i.fog=new o.Fog(15790320,40,180),at(.6,1.2),document.body.style.backgroundColor="#f0f0f0",x.style.color="black",M.style.color="black",D.style.backgroundColor="rgba(255,255,255,0.85)"),vt(t))}function at(t,e){for(let s=i.children.length-1;s>=0;s--){const c=i.children[s];c instanceof o.Light&&i.remove(c)}const r=new o.AmbientLight(16777215,t),n=new o.DirectionalLight(16777215,e);n.position.set(20,20,20),n.castShadow=!0,i.add(r),i.add(n)}function vt(t){i.traverse(e=>{if(e.isMesh){const n=e.material;if(!n||!n.color)return;n.roughness=t?.9:.5,n.color.offsetHSL(0,0,t?-.25:.25),n.needsUpdate=!0}})}ut.addEventListener("change",t=>{q=t.matches,J(q)});const S={};function dt(){J(q),Gt(),Lt(),Bt(),_t(),Dt(),wt()}function Gt(){i=new o.Scene,i.background=new o.Color(1710618),i.fog=new o.Fog(1710618,50,100),v=new o.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),v.position.set(0,10,20),R=new o.WebGLRenderer({antialias:!0}),R.setSize(innerWidth,innerHeight),R.shadowMap.enabled=!0,document.body.appendChild(R.domElement),i.add(new o.AmbientLight(16777215,.4));const t=new o.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,i.add(t),P=new Tt(v,R.domElement),P.enableDamping=!0,mt=new o.Clock,addEventListener("resize",()=>{v.aspect=innerWidth/innerHeight,v.updateProjectionMatrix(),R.setSize(innerWidth,innerHeight)})}function Lt(){const t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),r=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;g=new Ammo.btDiscreteDynamicsWorld(e,r,n,t),g.setGravity(new Ammo.btVector3(0,St,0)),tt=new Ammo.btTransform}function Bt(){const t=document.createElement("div");t.id="power-ui";const e=document.createElement("div");e.id="power-fill",t.appendChild(e),document.body.appendChild(t);const r=document.createElement("div");r.style.position="fixed",r.style.top="20px",r.style.right="20px",r.style.color="white",r.style.fontSize="20px",document.body.appendChild(r);const n=document.createElement("div");n.style.position="fixed",n.style.bottom="20px",n.style.right="20px",n.style.color="white",n.style.fontSize="18px",document.body.appendChild(n);const s=document.createElement("div");s.style.position="fixed",s.style.bottom="50%",s.style.left="50%",s.style.transform="translate(-50%, 50%)",s.style.color="white",s.style.fontSize="24px",s.style.backgroundColor="rgba(0, 0, 0, 0.7)",s.style.padding="15px 30px",s.style.borderRadius="10px",s.style.display="none",s.textContent=z("interact"),document.body.appendChild(s),X=e,x=r,M=n,D=s,X.style.display="none",x.style.display="block",M.style.display="none",I()}function I(){X.style.height=`${G/Q*100}%`,x.textContent=`${z("tries")}: ${B}`,M.textContent||=`${z("mode")}: NORMAL`}function Dt(){addEventListener("keydown",t=>{t.code==="Digit7"&&Z("en"),t.code==="Digit8"&&Z("zh"),t.code==="Digit9"&&Z("ar");const e=t.code;S[e]=!0,et&&(e==="Space"&&ft()&&(Y=!0),e==="Digit1"&&(nt=Et,M.textContent=`${z("mode")}: ${z("weak")}`),e==="Digit2"&&(nt=It,M.textContent=`${z("mode")}: ${z("strong")}`))}),addEventListener("keyup",t=>{S[t.code]=!1,N&&t.code==="Space"&&Nt()})}function Vt(){if(!m||N)return;const t=.15;S.KeyW&&(m.position.z-=t),S.KeyS&&(m.position.z+=t),S.KeyA&&(m.position.x-=t),S.KeyD&&(m.position.x+=t);const e=new o.Vector3;S.KeyW&&(e.z-=1),S.KeyS&&(e.z+=1),S.KeyA&&(e.x-=1),S.KeyD&&(e.x+=1),Ht(),qt()}const rt=[];function st(t,e=1,r=!1){const n=new o.BoxGeometry(e,e,e),s=new o.MeshStandardMaterial({color:8947848}),c=new o.Mesh(n,s);c.position.set(t.x,t.y??e/2,t.z),c.castShadow=!0,c.receiveShadow=!0,i.add(c);let a;if(r){const d=new Ammo.btBoxShape(new Ammo.btVector3(e/2,e/2,e/2));a=lt(d,0,t,i,E,g).body}const l={mesh:c,body:a,position:c.position.clone(),name:"cube",interactable:!0,pickedUp:!1};return rt.push(l),l}function Ot(){return m?m.position:null}let O=!1;addEventListener("keydown",t=>{t.code==="KeyE"&&(O=!0)});function Kt(){const t=Ot();if(!t){if(D.style.display="none",!O)return;O=!1,console.warn("Pickup attempted but no player/ball present.");return}const e=2.5;let r=!1;for(const s of rt){if(s.pickedUp)continue;const c=s.mesh.position.x-t.x,a=s.mesh.position.y-t.y,l=s.mesh.position.z-t.z;if(Math.sqrt(c*c+a*a+l*l)<=e){r=!0;break}}if(D.style.display=r?"block":"none",!O)return;O=!1;let n=!1;for(const s of rt){if(s.pickedUp)continue;const c=s.mesh.position.x-t.x,a=s.mesh.position.y-t.y,l=s.mesh.position.z-t.z;if(Math.sqrt(c*c+a*a+l*l)<=e){Ft(s),n=!0;break}}n||console.log("No items in range to pick up.")}function Ft(t){if(t.pickedUp=!0,t.interactable=!1,i.remove(t.mesh),t.body){g.removeRigidBody(t.body);const e=E.findIndex(r=>r.body===t.body);if(e!==-1){const r=E[e].mesh;i.remove(r),E.splice(e,1)}Ammo.destroy(t.body)}j++,B++,I(),console.log("Item picked up:",t.name,"| Inventory:",j,"| Tries:",B)}const W={x:0,z:-15,size:5};function Ht(){if(et)return;const t=m.position.x-W.x,e=m.position.z-W.z;t*t+e*e<W.size*W.size&&(et=!0,pt(),gt(),$t())}const _={x:0,z:-15,size:5};function qt(){if(N)return;const t=m.position.x-_.x,e=m.position.z-_.z;t*t+e*e<_.size*_.size&&(j===0?(alert(z("lose")),location.reload()):jt())}function ft(){if(!C)return!1;const t=C.getLinearVelocity();return Math.sqrt(t.x()**2+t.y()**2+t.z()**2)<.05&&!L}function Nt(){if(!Y||!C||L)return;Y=!1,ot=G>=Ct,$=!0;const t=new o.Vector3;v.getWorldDirection(t),t.y=0,t.normalize();const e=new o.Vector3(-t.z,0,t.x),r=ot?Math.random()*2*(Math.random()<.5?-1:1):0,n=G/Q*120*nt,s=new Ammo.btVector3(t.x*n+e.x*r,.15*(G/Q),t.z*n+e.z*r);C.activate(!0),C.applyCentralImpulse(s),B--,I()}function wt(){requestAnimationFrame(wt);const t=mt.getDelta();g.stepSimulation(t,10),E.forEach(e=>{const r=e.body.getMotionState();if(r){r.getWorldTransform(tt);const n=tt.getOrigin();e.mesh.position.set(n.x(),n.y(),n.z())}}),N||Vt(),Y&&!$&&(G=Math.min(Q,G+zt*t),I()),$&&ft()&&($=!1,G=0,ot=!1,I(),B<=0&&!L&&(L=!0,setTimeout(()=>{alert("ðŸ’€"),location.reload()},500))),F&&!L&&Ut(),Kt(),P.update(),R.render(i,v)}function Ut(){const t=F.position.x-H.x,e=F.position.z- -H.z;Math.sqrt(t*t+e*e)<2.5&&F.position.y<-2&&(alert(z("win")),L=!0)}function yt(){const t=window;t.Ammo?typeof t.Ammo=="function"?t.Ammo().then(dt):dt():setTimeout(yt,100)}yt();function _t(){J(q),x.style.display="block",I();const t=8,e=new o.PlaneGeometry(t,t),r=new o.MeshStandardMaterial({color:65280,transparent:!0,opacity:.3,side:o.DoubleSide}),n=new o.Mesh(e,r);n.rotation.x=-Math.PI/2,n.position.set(W.x,.01,W.z),i.add(n);const s=.1,c=new o.BoxGeometry(32,s,32),a=new o.MeshStandardMaterial({color:16777215,roughness:.6}),l=new o.Mesh(c,a);l.position.y=-s/2,l.receiveShadow=!0,i.add(l),st({x:-12,y:.8,z:-5},1,!0),st({x:12,y:.8,z:8},1,!0);const d=new o.Shape;d.moveTo(0,1),d.lineTo(-1,-1),d.lineTo(1,-1),d.lineTo(0,1);const u=new o.ExtrudeGeometry(d,{depth:.5,bevelEnabled:!1}),w=new o.MeshStandardMaterial({color:65484});m=new o.Mesh(u,w),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI,m.castShadow=!0,m.position.set(0,1,0),i.add(m);const h=2.5,b=.3,y=new o.MeshStandardMaterial({color:3355443,roughness:.7}),f=new o.BoxGeometry(32,h,b),p=new o.Mesh(f,y);p.position.set(0,h/2,-16),p.castShadow=!0,i.add(p);const A=p.clone();A.position.set(0,h/2,16),i.add(A);const V=new o.BoxGeometry(b,h,32),T=new o.Mesh(V,y);T.position.set(-16,h/2,0),T.castShadow=!0,i.add(T);const k=T.clone();k.position.set(16,h/2,0),i.add(k)}function $t(){i.background=new o.Color(1710618),i.fog=new o.Fog(1710618,50,100),bt(),x.style.display="block",I();const t=8,e=new o.PlaneGeometry(t,t),r=new o.MeshStandardMaterial({color:15616811,transparent:!0,opacity:.3,side:o.DoubleSide}),n=new o.Mesh(e,r);n.rotation.x=-Math.PI/2,n.position.set(W.x,.01,W.z),i.add(n);const s=.1,c=new o.BoxGeometry(32,s,32),a=new o.MeshStandardMaterial({color:16777215,roughness:.6}),l=new o.Mesh(c,a);l.position.y=-s/2,l.receiveShadow=!0,i.add(l),st({x:-10,y:.8,z:9},1,!0);const d=new o.Shape;d.moveTo(0,1),d.lineTo(-1,-1),d.lineTo(1,-1),d.lineTo(0,1);const u=new o.ExtrudeGeometry(d,{depth:.5,bevelEnabled:!1}),w=new o.MeshStandardMaterial({color:65484});m=new o.Mesh(u,w),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI,m.castShadow=!0,m.position.set(0,1,0),i.add(m);const h=2.5,b=.3,y=new o.MeshStandardMaterial({color:3355443,roughness:.7}),f=new o.BoxGeometry(32,h,b),p=new o.Mesh(f,y);p.position.set(0,h/2,-16),p.castShadow=!0,i.add(p);const A=p.clone();A.position.set(0,h/2,16),i.add(A);const V=new o.BoxGeometry(b,h,32),T=new o.Mesh(V,y);T.position.set(-16,h/2,0),T.castShadow=!0,i.add(T);const k=T.clone();k.position.set(16,h/2,0),i.add(k)}function jt(){J(q),N=!0,pt(),gt(),bt(),i.background=new o.Color(1710618),i.fog=new o.Fog(1710618,50,100),X.style.display="block",x.style.display="block",M.style.display="block",Qt(),I()}function Qt(){B=j,H={x:0,z:11};const t={x:0,y:2,z:12};kt({width:4,height:16},{x:0,z:0},{width:1.5,height:1.5},{x:H.x,z:H.z},i,g,0);const e=new Ammo.btSphereShape(1),r=lt(e,1,t,i,E,g);F=r.mesh,C=r.body;const n=1.1;U({width:1,height:2,depth:32},{x:4.5,z:0},i,g,.5,n),U({width:1,height:2,depth:32},{x:-4.5,z:0},i,g,.5,n),U({width:10,height:2,depth:1},{x:0,z:-16.5},i,g,.5,n),U({width:10,height:2,depth:1},{x:0,z:16.5},i,g,.5,n),C.setFriction(2.5),C.setRollingFriction(1.2),C.setDamping(.6,.9)}function pt(){for(;i.children.length>0;){const t=i.children.pop();t&&i.remove(t)}}function gt(){if(g)for(let t=E.length-1;t>=0;t--){const{body:e}=E[t];g.removeRigidBody(e),Ammo.destroy(e),E.splice(t,1)}}function bt(){i.add(new o.AmbientLight(16777215,.4));const t=new o.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,i.add(t)}

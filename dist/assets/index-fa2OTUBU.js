import*as n from"https://esm.sh/three@0.181.2";import{OrbitControls as Tt}from"https://esm.sh/three@0.181.2/examples/jsm/controls/OrbitControls.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const a of c.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(s){if(s.ep)return;s.ep=!0;const c=r(s);fetch(s.href,c)}})();function U(t,e,r,o,s=0,c=1.1,a=0,l=6710886){const d=new n.Mesh(new n.BoxGeometry(t.width,t.height,t.depth),new n.MeshStandardMaterial({color:l}));d.position.set(e.x,s,e.z),d.rotation.x=H(a),r.add(d);const u=new n.Mesh(new n.BoxGeometry(t.width,t.height,t.depth),new n.MeshStandardMaterial({color:0,wireframe:!0}));u.position.set(e.x,s,e.z),u.rotation.x=H(a),r.add(u);const w=new Ammo.btQuaternion;w.setRotation(new Ammo.btVector3(1,0,0),H(a));const h=new Ammo.btTransform;h.setIdentity(),h.setRotation(w),h.setOrigin(new Ammo.btVector3(e.x,s,e.z));const b=new Ammo.btBoxShape(new Ammo.btVector3(t.width/2,t.height/2,t.depth/2)),y=new Ammo.btDefaultMotionState(h),f=new Ammo.btVector3(0,0,0);b.calculateLocalInertia(0,f);const p=new Ammo.btRigidBodyConstructionInfo(0,y,b,f),A=new Ammo.btRigidBody(p);return A.setRestitution(c),o.addRigidBody(A),A}function kt(t,e,r,o,s,c,a=0,l=0){const d=new n.Shape;d.moveTo(-t.width+e.x,-16+e.z),d.lineTo(t.width+e.x,-16+e.z),d.lineTo(t.width+e.x,t.height+e.z),d.lineTo(-t.width+e.x,t.height+e.z),d.lineTo(-t.width+e.x,-16+e.z);const u=new n.Path;u.moveTo(-1.5+o.x,-r.height+o.z),u.lineTo(r.width+o.x,-r.height+o.z),u.lineTo(r.width+o.x,r.height+o.z),u.lineTo(-1.5+o.x,r.height+o.z),u.lineTo(-1.5+o.x,-r.height+o.z),d.holes.push(u);const w=new n.ShapeGeometry(d),h=new n.MeshStandardMaterial({color:10066329,side:n.DoubleSide}),b=new n.Mesh(w,h);b.rotation.x=-Math.PI/2+H(l),b.position.y=a,s.add(b);const y=new Ammo.btCompoundShape,f=new Ammo.btTransform;f.setIdentity();const p=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(o.z-e.z+(t.height-r.height))/2,.1));f.setOrigin(new Ammo.btVector3(e.x,(e.z+o.z-t.height-r.height)/2,a)),y.addChildShape(f,p);const A=new Ammo.btBoxShape(new Ammo.btVector3(t.width,(t.height-r.height-(o.z-e.z))/2,.1));f.setOrigin(new Ammo.btVector3(e.x,(t.height+r.height+e.z+o.z)/2,a)),y.addChildShape(f,A);const O=new Ammo.btBoxShape(new Ammo.btVector3((o.x-e.x+(t.width-r.width))/2,r.height,.1));f.setOrigin(new Ammo.btVector3((e.x+o.x-t.width-r.width)/2,o.z,a)),y.addChildShape(f,O);const T=new Ammo.btBoxShape(new Ammo.btVector3((t.width-r.width-(o.x-e.x))/2,r.height,.1));f.setOrigin(new Ammo.btVector3((e.x+o.x+r.width+t.width)/2,o.z,a)),y.addChildShape(f,T);const k=new Ammo.btTransform;k.setIdentity();const it=new Ammo.btQuaternion;it.setRotation(new Ammo.btVector3(1,0,0),-Math.PI/2+H(l)),k.setRotation(it),k.setOrigin(new Ammo.btVector3(0,0,0));const xt=new Ammo.btDefaultMotionState(k),Mt=new Ammo.btVector3(0,0,0),At=new Ammo.btRigidBodyConstructionInfo(0,xt,y,Mt),ct=new Ammo.btRigidBody(At);return c.addRigidBody(ct),ct}function lt(t,e,r,o,s,c){const a=t instanceof Ammo.btSphereShape?new n.Mesh(new n.SphereGeometry(1,32,32),new n.MeshStandardMaterial({color:10066329})):new n.Mesh(new n.BoxGeometry(1.5,1.5,1.5),new n.MeshStandardMaterial({color:6710886}));a.position.set(r.x,r.y,r.z),o.add(a);const l=new Ammo.btTransform;l.setIdentity(),l.setOrigin(new Ammo.btVector3(r.x,r.y,r.z));const d=new Ammo.btDefaultMotionState(l),u=new Ammo.btVector3(0,0,0);e&&t.calculateLocalInertia(e,u);const w=new Ammo.btRigidBody(new Ammo.btRigidBodyConstructionInfo(e,d,t,u));return w.setRestitution(.8),c.addRigidBody(w),s.push({body:w,mesh:a}),{body:w,mesh:a}}function H(t){return t*(Math.PI/180)}let i,G,v,P,mt,g,tt;const I=[];let E,q,m,et=!1,N=!1,B=!1,D=0,j=0;const St=-50,Q=100,zt=40,Et=85;let F={x:0,z:0},L=0,Y=!1,$=!1,ot=!1,nt=1;const It=.6,Wt=1.6;let X,x,M,V,ht="en";const Rt={en:{tries:"Tries",mode:"Mode",weak:"WEAK",strong:"STRONG",interact:"Press E to interact",win:"ðŸŽ‰ You Win!",lose:"ðŸ’€"},zh:{tries:"æ¬¡æ•°",mode:"æ¨¡å¼",weak:"å¼±",strong:"å¼º",interact:"æŒ‰ E é”®äº’åŠ¨",win:"ðŸŽ‰ ä½ èµ¢äº†ï¼",lose:"ðŸ’€"},ar:{tries:"Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª",mode:"Ø§Ù„ÙˆØ¶Ø¹",weak:"Ø¶Ø¹ÙŠÙ",strong:"Ù‚ÙˆÙŠ",interact:"Ø§Ø¶ØºØ· E Ù„Ù„ØªÙØ§Ø¹Ù„",win:"ðŸŽ‰ ÙØ²Øª!",lose:"ðŸ’€"}};function z(t){return Rt[ht][t]}function Z(t){ht=t,V.textContent=z("interact"),R(),Ct(t)}function Ct(t){t==="ar"?(document.body.dir="rtl",x.style.right="auto",x.style.left="20px",M.style.right="auto",M.style.left="20px"):(document.body.dir="ltr",x.style.left="auto",x.style.right="20px",M.style.left="auto",M.style.right="20px")}const ut=globalThis.matchMedia("(prefers-color-scheme: dark)");let W=ut.matches;function J(t){i&&(t?(i.background=new n.Color(855309),i.fog=new n.Fog(855309,30,120),at(.25,.8),document.body.style.backgroundColor="#0d0d0d",x.style.color="white",M.style.color="white",V.style.backgroundColor="rgba(0,0,0,0.7)"):(i.background=new n.Color(15790320),i.fog=new n.Fog(15790320,40,180),at(.6,1.2),document.body.style.backgroundColor="#f0f0f0",x.style.color="black",M.style.color="black",V.style.backgroundColor="rgba(255,255,255,0.85)"),vt(t))}function at(t,e){for(let s=i.children.length-1;s>=0;s--){const c=i.children[s];c instanceof n.Light&&i.remove(c)}const r=new n.AmbientLight(16777215,t),o=new n.DirectionalLight(16777215,e);o.position.set(20,20,20),o.castShadow=!0,i.add(r),i.add(o)}function vt(t){i.traverse(e=>{if(e.isMesh){const o=e.material;if(!o||!o.color)return;o.roughness=t?.9:.5,o.color.offsetHSL(0,0,t?-.25:.25),o.needsUpdate=!0}})}ut.addEventListener("change",t=>{W=t.matches,J(W)});const S={};function dt(){J(W),Gt(),Lt(),Bt(),_t(),Dt(),wt()}function Gt(){i=new n.Scene,G=new n.PerspectiveCamera(75,innerWidth/innerHeight,.1,1e3),G.position.set(0,10,20),v=new n.WebGLRenderer({antialias:!0}),v.setSize(innerWidth,innerHeight),v.shadowMap.enabled=!0,document.body.appendChild(v.domElement),i.add(new n.AmbientLight(16777215,.4));const t=new n.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,i.add(t),P=new Tt(G,v.domElement),P.enableDamping=!0,mt=new n.Clock,addEventListener("resize",()=>{G.aspect=innerWidth/innerHeight,G.updateProjectionMatrix(),v.setSize(innerWidth,innerHeight)})}function Lt(){const t=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(t),r=new Ammo.btDbvtBroadphase,o=new Ammo.btSequentialImpulseConstraintSolver;g=new Ammo.btDiscreteDynamicsWorld(e,r,o,t),g.setGravity(new Ammo.btVector3(0,St,0)),tt=new Ammo.btTransform}function Bt(){const t=document.createElement("div");t.id="power-ui";const e=document.createElement("div");e.id="power-fill",t.appendChild(e),document.body.appendChild(t);const r=document.createElement("div");r.style.position="fixed",r.style.top="20px",r.style.right="20px",r.style.color="white",r.style.fontSize="20px",document.body.appendChild(r);const o=document.createElement("div");o.style.position="fixed",o.style.bottom="20px",o.style.right="20px",o.style.color="white",o.style.fontSize="18px",document.body.appendChild(o);const s=document.createElement("div");s.style.position="fixed",s.style.bottom="50%",s.style.left="50%",s.style.transform="translate(-50%, 50%)",s.style.color="white",s.style.fontSize="24px",s.style.backgroundColor="rgba(0, 0, 0, 0.7)",s.style.padding="15px 30px",s.style.borderRadius="10px",s.style.display="none",s.textContent=z("interact"),document.body.appendChild(s),X=e,x=r,M=o,V=s,X.style.display="none",x.style.display="block",M.style.display="none",R()}function R(){X.style.height=`${L/Q*100}%`,x.textContent=`${z("tries")}: ${D}`,M.textContent||=`${z("mode")}: NORMAL`}function Dt(){addEventListener("keydown",t=>{t.code==="Digit7"&&Z("en"),t.code==="Digit8"&&Z("zh"),t.code==="Digit9"&&Z("ar");const e=t.code;S[e]=!0,et&&(e==="Space"&&ft()&&(Y=!0),e==="Digit1"&&(nt=It,M.textContent=`${z("mode")}: ${z("weak")}`),e==="Digit2"&&(nt=Wt,M.textContent=`${z("mode")}: ${z("strong")}`))}),addEventListener("keyup",t=>{S[t.code]=!1,N&&t.code==="Space"&&Nt()})}function Vt(){if(!m||N)return;const t=.15;S.KeyW&&(m.position.z-=t),S.KeyS&&(m.position.z+=t),S.KeyA&&(m.position.x-=t),S.KeyD&&(m.position.x+=t);const e=new n.Vector3;S.KeyW&&(e.z-=1),S.KeyS&&(e.z+=1),S.KeyA&&(e.x-=1),S.KeyD&&(e.x+=1),qt(),Ft()}const rt=[];function st(t,e=1,r=!1){const o=new n.BoxGeometry(e,e,e),s=new n.MeshStandardMaterial({color:8947848}),c=new n.Mesh(o,s);c.position.set(t.x,t.y??e/2,t.z),c.castShadow=!0,c.receiveShadow=!0,i.add(c);let a;if(r){const d=new Ammo.btBoxShape(new Ammo.btVector3(e/2,e/2,e/2));a=lt(d,0,t,i,I,g).body}const l={mesh:c,body:a,position:c.position.clone(),name:"cube",interactable:!0,pickedUp:!1};return rt.push(l),l}function Ot(){return m?m.position:null}let K=!1;addEventListener("keydown",t=>{t.code==="KeyE"&&(K=!0)});function Kt(){const t=Ot();if(!t){if(V.style.display="none",!K)return;K=!1,console.warn("Pickup attempted but no player/ball present.");return}const e=2.5;let r=!1;for(const s of rt){if(s.pickedUp)continue;const c=s.mesh.position.x-t.x,a=s.mesh.position.y-t.y,l=s.mesh.position.z-t.z;if(Math.sqrt(c*c+a*a+l*l)<=e){r=!0;break}}if(V.style.display=r?"block":"none",!K)return;K=!1;let o=!1;for(const s of rt){if(s.pickedUp)continue;const c=s.mesh.position.x-t.x,a=s.mesh.position.y-t.y,l=s.mesh.position.z-t.z;if(Math.sqrt(c*c+a*a+l*l)<=e){Ht(s),o=!0;break}}o||console.log("No items in range to pick up.")}function Ht(t){if(t.pickedUp=!0,t.interactable=!1,i.remove(t.mesh),t.body){g.removeRigidBody(t.body);const e=I.findIndex(r=>r.body===t.body);if(e!==-1){const r=I[e].mesh;i.remove(r),I.splice(e,1)}Ammo.destroy(t.body)}j++,D++,R(),console.log("Item picked up:",t.name,"| Inventory:",j,"| Tries:",D)}const C={x:0,z:-15,size:5};function qt(){if(et)return;const t=m.position.x-C.x,e=m.position.z-C.z;t*t+e*e<C.size*C.size&&(et=!0,pt(),gt(),$t())}const _={x:0,z:-15,size:5};function Ft(){if(N)return;const t=m.position.x-_.x,e=m.position.z-_.z;t*t+e*e<_.size*_.size&&(j===0?(alert(z("lose")),location.reload()):jt())}function ft(){if(!E)return!1;const t=E.getLinearVelocity();return Math.sqrt(t.x()**2+t.y()**2+t.z()**2)<.05&&!B}function Nt(){if(!Y||!E||B)return;Y=!1,ot=L>=Et,$=!0;const t=new n.Vector3;G.getWorldDirection(t),t.y=0,t.normalize();const e=new n.Vector3(-t.z,0,t.x),r=ot?Math.random()*2*(Math.random()<.5?-1:1):0,o=L/Q*120*nt,s=new Ammo.btVector3(t.x*o+e.x*r,.15*(L/Q),t.z*o+e.z*r);E.activate(!0),E.applyCentralImpulse(s),D--,R()}function wt(){requestAnimationFrame(wt);const t=mt.getDelta();g.stepSimulation(t,10),I.forEach(e=>{const r=e.body.getMotionState();if(r){r.getWorldTransform(tt);const o=tt.getOrigin();e.mesh.position.set(o.x(),o.y(),o.z())}}),N||Vt(),Y&&!$&&(L=Math.min(Q,L+zt*t),R()),$&&ft()&&($=!1,L=0,ot=!1,R(),D<=0&&!B&&(B=!0,setTimeout(()=>{alert("ðŸ’€"),location.reload()},500))),q&&!B&&Ut(),Kt(),P.update(),v.render(i,G)}function Ut(){const t=q.position.x-F.x,e=q.position.z- -F.z;Math.sqrt(t*t+e*e)<2.5&&q.position.y<-2&&(alert(z("win")),B=!0)}function yt(){const t=window;t.Ammo?typeof t.Ammo=="function"?t.Ammo().then(dt):dt():setTimeout(yt,100)}yt();function _t(){x.style.display="block",R();const t=8,e=new n.PlaneGeometry(t,t),r=new n.MeshStandardMaterial({color:65280,transparent:!0,opacity:.3,side:n.DoubleSide}),o=new n.Mesh(e,r);o.rotation.x=-Math.PI/2,o.position.set(C.x,.01,C.z),i.add(o);const s=.1,c=new n.BoxGeometry(32,s,32),a=new n.MeshStandardMaterial({color:16777215,roughness:.6}),l=new n.Mesh(c,a);l.position.y=-s/2,l.receiveShadow=!0,i.add(l),st({x:-12,y:.8,z:-5},1,!0),st({x:12,y:.8,z:8},1,!0);const d=new n.Shape;d.moveTo(0,1),d.lineTo(-1,-1),d.lineTo(1,-1),d.lineTo(0,1);const u=new n.ExtrudeGeometry(d,{depth:.5,bevelEnabled:!1}),w=new n.MeshStandardMaterial({color:65484});m=new n.Mesh(u,w),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI,m.castShadow=!0,m.position.set(0,1,0),i.add(m);const h=2.5,b=.3,y=new n.MeshStandardMaterial({color:W?3355443:14540253,roughness:W?.8:.4}),f=new n.BoxGeometry(32,h,b),p=new n.Mesh(f,y);p.position.set(0,h/2,-16),p.castShadow=!0,i.add(p);const A=p.clone();A.position.set(0,h/2,16),i.add(A);const O=new n.BoxGeometry(b,h,32),T=new n.Mesh(O,y);T.position.set(-16,h/2,0),T.castShadow=!0,i.add(T);const k=T.clone();k.position.set(16,h/2,0),i.add(k),J(W)}function $t(){bt(),x.style.display="block",R();const t=8,e=new n.PlaneGeometry(t,t),r=new n.MeshStandardMaterial({color:15616811,transparent:!0,opacity:.3,side:n.DoubleSide}),o=new n.Mesh(e,r);o.rotation.x=-Math.PI/2,o.position.set(C.x,.01,C.z),i.add(o);const s=.1,c=new n.BoxGeometry(32,s,32),a=new n.MeshStandardMaterial({color:16777215,roughness:.6}),l=new n.Mesh(c,a);l.position.y=-s/2,l.receiveShadow=!0,i.add(l),st({x:-10,y:.8,z:9},1,!0);const d=new n.Shape;d.moveTo(0,1),d.lineTo(-1,-1),d.lineTo(1,-1),d.lineTo(0,1);const u=new n.ExtrudeGeometry(d,{depth:.5,bevelEnabled:!1}),w=new n.MeshStandardMaterial({color:65484});m=new n.Mesh(u,w),m.rotation.x=Math.PI/2,m.rotation.z=Math.PI,m.castShadow=!0,m.position.set(0,1,0),i.add(m);const h=2.5,b=.3,y=new n.MeshStandardMaterial({color:W?3355443:14540253,roughness:W?.8:.4}),f=new n.BoxGeometry(32,h,b),p=new n.Mesh(f,y);p.position.set(0,h/2,-16),p.castShadow=!0,i.add(p);const A=p.clone();A.position.set(0,h/2,16),i.add(A);const O=new n.BoxGeometry(b,h,32),T=new n.Mesh(O,y);T.position.set(-16,h/2,0),T.castShadow=!0,i.add(T);const k=T.clone();k.position.set(16,h/2,0),i.add(k)}function jt(){N=!0,pt(),gt(),bt(),X.style.display="block",x.style.display="block",M.style.display="block",Qt(),R(),J(W)}function Qt(){D=j,F={x:0,z:11};const t={x:0,y:2,z:12};kt({width:4,height:16},{x:0,z:0},{width:1.5,height:1.5},{x:F.x,z:F.z},i,g,0);const e=new Ammo.btSphereShape(1),r=lt(e,1,t,i,I,g);q=r.mesh,E=r.body;const o=1.1;U({width:1,height:2,depth:32},{x:4.5,z:0},i,g,.5,o),U({width:1,height:2,depth:32},{x:-4.5,z:0},i,g,.5,o),U({width:10,height:2,depth:1},{x:0,z:-16.5},i,g,.5,o),U({width:10,height:2,depth:1},{x:0,z:16.5},i,g,.5,o),E.setFriction(2.5),E.setRollingFriction(1.2),E.setDamping(.6,.9)}function pt(){for(;i.children.length>0;){const t=i.children.pop();t&&i.remove(t)}}function gt(){if(g)for(let t=I.length-1;t>=0;t--){const{body:e}=I[t];g.removeRigidBody(e),Ammo.destroy(e),I.splice(t,1)}}function bt(){i.add(new n.AmbientLight(16777215,.4));const t=new n.DirectionalLight(16777215,1);t.position.set(20,20,20),t.castShadow=!0,i.add(t)}
